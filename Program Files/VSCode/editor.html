<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/monaco-editor@0.51.0/min/vs/editor/editor.main.css">
    <style type="text/css">
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="container" style="width: 100%; height: 100%"></div>
    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script>
        var editor, origin, filePath, fileContent, source;

        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@latest/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('container'), {
                value: '',
                language: '',
                theme: 'vs-dark'
            });

            document.addEventListener('keydown', function (e) {
                if (e.ctrlKey && e.key.toLocaleLowerCase() == 's') {
                    console.log('Save file')
                    e.preventDefault();
                    if (origin) {
                        source.postMessage({
                            type: 'action',
                            action: 'save',
                            content: editor.getValue(),
                            file: filePath
                        }, origin);
                    }
                }
            });

            window.onresize = function () {
                editor.layout();
            };
        });

        function getLanguage(extension) {
            switch (extension) {
                case 'js':
                    return 'javascript';
                case 'html':
                    return 'html';
                case 'css':
                    return 'css';
                case 'json':
                    return 'json';
                default:
                    return 'plaintext';
            }
        }

        window.addEventListener('message', (event) => {
            origin = event.origin;
            source = event.source;

            var message = event.data;
            if (message.type == 'init') {
                var status = 'ok';
                try {
                    filePath = message.filePath;
                    fileContent = message.fileContent;
                    editor.setValue(message.fileContent);
                    monaco.editor.setModelLanguage(editor.getModel(), getLanguage(filePath.split('.').pop().toLowerCase()));
                } catch (error) {
                    console.error('Error loading file:', error);
                    status = 'error';
                }

                source.postMessage({
                    type: 'check',
                    status: status
                }, origin);
            }
        });
    </script>
</body>

</html>