// perfect-freehand
function Y(e,t,u,x=g=>g){return e*x(.5-t*(.5-u))}function c(e,t){return[e[0]+t[0],e[1]+t[1]]}function p(e,t){return[e[0]-t[0],e[1]-t[1]]}function b(e,t){return[e[0]*t,e[1]*t]}function fe(e,t){return[e[0]/t,e[1]/t]}function I(e){return[e[1],-e[0]]}function re(e,t){return e[0]*t[0]+e[1]*t[1]}function oe(e,t){return e[0]===t[0]&&e[1]===t[1]}function be(e){return Math.hypot(e[0],e[1])}function ge(e){return e[0]*e[0]+e[1]*e[1]}function Z(e,t){return ge(p(e,t))}function K(e){return fe(e,be(e))}function se(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function ue(e,t){return b(c(e,t),.5)}function V(e,t,u){let x=Math.sin(u),g=Math.cos(u),y=e[0]-t[0],r=e[1]-t[1],d=y*g-r*x,L=y*x+r*g;return[d+t[0],L+t[1]]}function H(e,t,u){return c(e,b(p(t,e),u))}function $(e,t,u){return c(e,b(t,u))}var{min:_,PI:de}=Math,ie=.275,j=de+1e-4;function pe(e,t={}){let{size:u=16,smoothing:x=.5,thinning:g=.5,simulatePressure:y=!0,easing:r=n=>n,start:d={},end:L={},last:q=!1}=t,{cap:S=!0,taper:k=0,easing:C=n=>n*(2-n)}=d,{cap:a=!0,taper:l=0,easing:T=n=>--n*n*n+1}=L;if(e.length===0||u<=0)return[];let N=e[e.length-1].runningLength,B=Math.pow(u*x,2),O=[],P=[],U=e.slice(0,10).reduce((n,i)=>{let o=i.pressure;if(y){let s=_(1,i.distance/u),f=_(1,1-s);o=_(1,n+(f-n)*(s*ie))}return(n+o)/2},e[0].pressure),m=Y(u,g,e[e.length-1].pressure,r),X,A=e[0].vector,z=e[0].point,F=z,E=z,M=F;for(let n=0;n<e.length-1;n++){let{pressure:i}=e[n],{point:o,vector:s,distance:f,runningLength:R}=e[n];if(N-R<3)continue;if(g){if(y){let D=_(1,f/u),W=_(1,1-D);i=_(1,U+(W-U)*(D*ie))}m=Y(u,g,i,r)}else m=u/2;X===void 0&&(X=m);let ae=R<k?C(R/k):1,le=N-R<l?T((N-R)/l):1;m=Math.max(.01,m*Math.min(ae,le));let ee=e[n+1].vector,te=re(s,ee);if(te<0){let D=b(I(A),m);for(let W=1/13,G=0;G<=1;G+=W)E=V(p(o,D),o,j*G),O.push(E),M=V(c(o,D),o,j*-G),P.push(M);z=E,F=M;continue}let ne=b(I(H(ee,s,te)),m);E=p(o,ne),(n===0||Z(z,E)>B)&&(O.push(E),z=E),M=c(o,ne),(n===0||Z(F,M)>B)&&(P.push(M),F=M),U=i,A=s}let v=e[0].point.slice(0,2),h=e.length>1?e[e.length-1].point.slice(0,2):c(e[0].point,[1,1]),J=O.length<=1||P.length<=1,Q=[],w=[];if(J){if(!(k||l)||q){let n=$(v,K(I(p(v,h))),-(X||m)),i=[];for(let o=1/13,s=o;s<=1;s+=o)i.push(V(n,v,j*2*s));return i}}else{if(!(k||l&&J))if(S)for(let o=1/13,s=o;s<=1;s+=o){let f=V(P[0],v,j*s);Q.push(f)}else{let o=p(O[0],P[0]),s=b(o,.5),f=b(o,.51);Q.push(p(v,s),p(v,f),c(v,f),c(v,s))}let n=ue(O[O.length-1],P[P.length-1]),i=I(K(p(h,n)));if(l||k&&J)w.push(h);else if(a){let o=$(h,i,m);for(let s=1/29,f=0;f<=1;f+=s){let R=V(o,h,j*3*f);w.push(R)}}else w.push(c(h,b(i,m)),c(h,b(i,m*.99)),p(h,b(i,m*.99)),p(h,b(i,m)))}return O.concat(w,P.reverse(),Q)}function me(e,t={}){var C;let{streamline:u=.5,size:x=16,last:g=!1}=t;if(e.length===0)return[];let y=.15+(1-u)*.85,r=Array.isArray(e[0])?e:e.map(({x:a,y:l,pressure:T=.5})=>[a,l,T]);r.length===1&&(r=[...r,[...c(r[0],[1,1]),...r[0].slice(2)]]);let d=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],L=!1,q=0,S=d[0],k=r.length-1;for(let a=1;a<r.length;a++){let l=g&&a===k?r[a]:H(S.point,r[a],y);if(oe(S.point,l))continue;let T=se(l,S.point);if(q+=T,a<k&&!L){if(q<x)continue;L=!0}S={point:l,pressure:r[a][2]>=0?r[a][2]:.5,vector:K(p(S.point,l)),distance:T,runningLength:q},d.push(S)}return d[0].vector=((C=d[1])==null?void 0:C.vector)||[0,0],d}function ce(e,t={}){return pe(me(e,t),t)};
module.exports={getStroke:ce,getStrokeOutlinePoints:pe,getStrokePoints:me};
