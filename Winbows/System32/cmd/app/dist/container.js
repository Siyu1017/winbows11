/*!
 * Winbows Command Prompt
 * Copyright (c) Microhard 2025
 * Github : Siyu1017/winbows11
 */
var e,t={exports:{}};var n,o,r=e?t.exports:(e=1,self,t.exports=(n=o={},Object.defineProperty(n,"__esModule",{value:!0}),n.FitAddon=void 0,n.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const n=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,o=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(o.getPropertyValue("height")),i=Math.max(0,parseInt(o.getPropertyValue("width"))),s=window.getComputedStyle(this._terminal.element),l=r-(parseInt(s.getPropertyValue("padding-top"))+parseInt(s.getPropertyValue("padding-bottom"))),a=i-(parseInt(s.getPropertyValue("padding-right"))+parseInt(s.getPropertyValue("padding-left")))-n;return{cols:Math.max(2,Math.floor(a/t.css.cell.width)),rows:Math.max(1,Math.floor(l/t.css.cell.height))}}},o));!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".xterm{cursor:text;position:relative;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;z-index:5}.xterm .xterm-helper-textarea{border:0;height:0;left:-9999em;margin:0;opacity:0;overflow:hidden;padding:0;position:absolute;resize:none;top:0;white-space:nowrap;width:0;z-index:-5}.xterm .composition-view{background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{background-color:#000;bottom:0;cursor:default;left:0;overflow-y:scroll;position:absolute;right:0;top:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{left:0;position:absolute;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;left:-9999em;line-height:normal;position:absolute;top:0;visibility:hidden}.xterm.enable-mouse-events{cursor:default}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{bottom:0;color:transparent;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:10}.xterm .live-region{height:1px;left:-9999px;overflow:hidden;position:absolute;width:1px}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{text-decoration:double underline}.xterm-underline-3{text-decoration:wavy underline}.xterm-underline-4{text-decoration:dotted underline}.xterm-underline-5{text-decoration:dashed underline}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:overline underline}.xterm-overline.xterm-underline-2{text-decoration:overline double underline}.xterm-overline.xterm-underline-3{text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{position:absolute;z-index:6}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{pointer-events:none;position:absolute;right:0;top:0;z-index:8}.xterm-decoration-top{position:relative;z-index:2}");const i=document.createElement("style");i.innerHTML=".window-content * {color: #fff;font: 1rem monospace;white-space:pre-wrap;line-height: 1.12;} .window-content,.window-toolbar{background:rgb(18, 18, 18) !important;} *::selection{ background:#fff;color:#000} .xterm { height: inherit;}",document.head.appendChild(i),browserWindow.setTheme("dark"),document.documentElement.classList.add("winui"),document.documentElement.classList.add("winui-no-background"),document.documentElement.classList.add("winui-dark"),document.body.style="padding: .5rem; padding-right: 0;";const s=document.createElement("div");function l(e,t,n){const[o,r,i]=function(e){const t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]}(n);e.write(`[38;2;${o};${r};${i}m${t}[0m`)}s.style="height: 100%;",document.body.appendChild(s),process.title="Command Prompt";const a=new WinUI.Terminal({cols:80,rows:24,convertEol:!0,cursorBlink:!0,theme:{background:"rgb(18, 18, 18)",foreground:"#d4d4d4"}}),c=new r.FitAddon,d=new ResizeObserver((()=>{c.fit()}));a.loadAddon(c),a.open(s),c.fit(),d.observe(s);const m=process.env.pipe,u=IPC.connect(m),p=await(async()=>new Promise((e=>{u.on("data",(t=>{const n=t.data;if("check"==n.type){if(console.log(token.value,n.data,token),n.data!==token.value||!token.isTrusted)return process.exit();u.send({type:"ready"})}if("data"==n.type){const t=n.data;e(t),browserWindow.changeTitle(t.__filename),console.info("Got WRT:",t)}})),u.send({type:"ready"})})))();let x=!0,h=0,f="",w=null;function v(e,t,n){const o=n.slice(e);n.match(/\S+/),a.write(o),function(e,t,n,o){const r=t.length;n+=r,o+=r;const i=e.cols,s=~~(n/i),l=~~(o/i),a=n%i,c=o%i;if(s!=l&&n!=o){let t=s-l;0==c&&t--,t>0&&e.write(`[${t}A`)}if(a!=c){const t=a-c;t>0?e.write(`[${t}D`):e.write(`[${-t}C`)}}(a,"",n.length,t)}p.process.stdout.on("data",(e=>{a.write(e)})),p.process.stderr.on("data",(e=>{l(a,e,"#ff796d")})),p.process.on("exit",(()=>{!1!==x&&(a.write("\r\r\nPress any key to continue..."),x=!1)})),process.on("exit",(()=>{x=!1,p.kill()})),a.attachCustomKeyEventHandler((e=>!e.ctrlKey||!["v","a"].includes(e.key.toLowerCase()))),a.onKey((async({domEvent:e})=>{const t=e;if(t.ctrlKey&&"c"===t.key.toLowerCase()){t.preventDefault();const e=a.getSelection();!e&&p.alive?(l(a,"^C","#ff3232"),w="kill"):await navigator.clipboard.writeText(e)}else;})),a.onData((async e=>{if(console.info("Received data:",e,function(e){let t=0,n=0;const o=e=>{const t=e.codePointAt(0);return!(t<=31||t>=127&&t<=159||[8203,8204,8205,65279].includes(t)||t>=768&&t<=879)};for(;n<e.length;){const r=e.charCodeAt(n);if(r<=31&&27!==r||r>=127&&r<=159)n++;else if(27!==r)o(e[n])&&t++,n++;else{const t=e[n+1];if("["===t){for(n+=2;n<e.length&&!/[A-Za-z]/.test(e[n]);)n++;n++;continue}if("]"===t){for(n+=2;n<e.length&&""!==e[n];){if(""===e[n]&&"\\"===e[n+1]){n+=2;break}n++}n++;continue}if("P"===t){for(n+=2;n<e.length&&(""!==e[n]||"\\"!==e[n+1]);)n++;n+=2;continue}n+=2}}return t}(e)),"kill"==w)p.kill(),w=null;else if(0==p.alive)process.exit();else if(""===e)return;if(!p.process.stdin?.isPaused?.())return p.process.stdin.isRaw?p.process.stdin.write(e):void async function(e){if(0!=e.length){switch(e){case"[A":case"[B":return;case"[C":return void(h<f.length&&(h++,h%a.cols==0?a.write("[B\r"):a.write(e)));case"[D":return void(h>0&&(h--,(h+1)%a.cols==0?a.write(`[A\r[${a.cols+1}C`):a.write(e)))}if("\r"===e)p.process.stdin.write(f),h=0,f="";else{if(""!==e){const t=h;return f=f.slice(0,h)+e+f.slice(h),h+=e.length,a.write("[0J"),void v(t,h,f)}if(f.length>0&&h>0){const e=h;f=f.slice(0,h-1<0?0:h-1)+f.slice(h),h--;const t=a.cols;e%t==0&&~~(e/t)>0?a.write(`[A[${t}C`):a.write("[D"),a.write("[0J"),v(h,h,f)}}}}(e)})),p.main();
